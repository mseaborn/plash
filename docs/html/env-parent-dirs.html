<html><head><meta http-equiv="Content-Type" content="text/html; charset=ANSI_X3.4-1968"><title>Parent directories: the semantics of dot-dot using dir_stacks</title><meta name="generator" content="DocBook XSL Stylesheets V1.68.1"><link rel="start" href="index.html" title="Plash: the Principle of Least Authority shell"><link rel="up" href="env.html" title="Chapter&#160;3.&#160;Plash's restricted execution environment"><link rel="prev" href="env-symlinks.html" title="Symbolic links"><link rel="next" href="env-dir-fds.html" title="Directory file descriptors"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Parent directories: the semantics of dot-dot using dir_stacks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="env-symlinks.html">Prev</a>&#160;</td><th width="60%" align="center">Chapter&#160;3.&#160;Plash's restricted execution environment</th><td width="20%" align="right">&#160;<a accesskey="n" href="env-dir-fds.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="env-parent-dirs"></a>Parent directories: the semantics of dot-dot using dir_stacks</h2></div></div></div><p>A directory may have different parent directories in different
namespaces.  Furthermore, a directory may appear multiple times in the
same namespace, and so have multiple parents in that namespace.  `..' 
does not fit well into a system based on object references.  However,
it is widely used by Unix programs, so we have to support it.</p><p>Rather than using the `..' parent directory facility provided by the
underlying filesystem, the file server interprets `..' itself.</p><p>The semantics is that the parent of a directory is the directory that
it was reached through, after symlinks have been expanded.</p><p>This means that the filename resolver maintains a stack of directory
object references, called a dir_stack.  When resolving the pathname
`/a/b/..', it will first push the root directory onto the stack, then
directory objects for `/a' and `/a/b', and then it will pop `/a/b' off
the stack, leaving `/a' at the top of the stack as the result.</p><p>If `/a/b' is a symlink to `g/h', however, the filename resolver does
not push `/a/b' onto the stack (since `/a/b' is not a directory object).
It pushes `/a/g' and then `/a/g/h' onto the stack.  Then, when it
interprets `..' in the pathname, it pops `/a/g/h' off the stack to
leave `/a/g' (the result) at the top.</p><p>The server represents the current working directory as one of these
directory stacks.  One of the consequences of these semantics is that
if the current working directory is renamed or moved, the result of
getcwd() will not reflect this.</p><p>This approach means that doing:
</p><pre class="programlisting">chdir("leafname")
  chdir("..")
</pre><p>
has no effect (provided that the first call succeeds).  This contrasts
with the usual Unix semantics, where the "leafname" directory could
be moved between the two calls, giving it a different parent directory.
This is partly why programs like "rm" use <code class="function">fchdir()</code> -- to avoid this
problem.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="env-symlinks.html">Prev</a>&#160;</td><td width="20%" align="center"><a accesskey="u" href="env.html">Up</a></td><td width="40%" align="right">&#160;<a accesskey="n" href="env-dir-fds.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Symbolic links&#160;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&#160;Directory file descriptors</td></tr></table></div></body></html>
