<html><head><meta http-equiv="Content-Type" content="text/html; charset=ANSI_X3.4-1968"><title>Chapter&#160;7.&#160;Internals</title><meta name="generator" content="DocBook XSL Stylesheets V1.68.1"><link rel="start" href="index.html" title="Plash: the Principle of Least Authority shell"><link rel="up" href="index.html" title="Plash: the Principle of Least Authority shell"><link rel="prev" href="gc-uid-locks.html" title="gc-uid-locks"><link rel="next" href="internal-string.html" title="String handling"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&#160;7.&#160;Internals</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="gc-uid-locks.html">Prev</a>&#160;</td><th width="60%" align="center">&#160;</th><td width="20%" align="right">&#160;<a accesskey="n" href="internal-string.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="internal"></a>Chapter&#160;7.&#160;Internals</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="internal.html#internal-regions">Region-based memory management</a></span></dt><dt><span class="sect1"><a href="internal-string.html">String handling</a></span></dt><dt><span class="sect1"><a href="internal-objects.html">Object system</a></span></dt><dd><dl><dt><span class="sect2"><a href="internal-objects.html#id2526900">Methods</a></span></dt><dt><span class="sect2"><a href="internal-objects.html#id2526923">Reference counting</a></span></dt><dt><span class="sect2"><a href="internal-objects.html#id2526944">Marshalling</a></span></dt></dl></dd><dt><span class="sect1"><a href="internal-marshal.html">Encodings for marshalling</a></span></dt><dt><span class="sect1"><a href="xxml.html">Documentation format: XXML, an XML surface syntax</a></span></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="internal-regions"></a>Region-based memory management</h2></div></div></div><p>See region.h</p><p>A lot of the memory management in Plash is done using regions.
Regions work like this:</p><div class="orderedlist"><ol type="1"><li><p>You create a region.  This allocates a medium-sized block (eg. 1k) initially.</p></li><li><p>You allocate blocks from the region.</p></li><li><p>You free the whole region.  This frees all the blocks that were allocated from it.</p></li></ol></div><p>Regions don't provide a way to free individual blocks in the region.
This means that allocation is fast, because there's no fragmentation
within a region.  Deallocation is fast too, because all the blocks are
freed in one step.</p><p>The main reason for using regions in Plash is convenience.
Deallocation becomes much less of a burden, and is easier to get
right, so the chances of memory leaks are reduced.  If a complex
structure is region-allocated, you don't need to traverse the
structure to free each node individually.</p><p>Using regions works well when allocation and deallocation follow the
structure of the function call tree: when a structure is not used
outside of the function that allocates it or the parent of the
function that allocates it.  When this is not the case, and the
amounts of storage allocated are large, regions are not so good.</p><p>Plash uses reference counting for storage management when regions are
not appropriate.</p><p>It is possible to attach explicit finalisers to a region, so that when
the region is free, other resources are freed, eg. file descriptors
can be closed.
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gc-uid-locks.html">Prev</a>&#160;</td><td width="20%" align="center">&#160;</td><td width="40%" align="right">&#160;<a accesskey="n" href="internal-string.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">gc-uid-locks&#160;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&#160;String handling</td></tr></table></div></body></html>
